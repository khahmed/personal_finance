# Quick Start: Parser Generator

## Generate a Parser in 5 Minutes

### 1. Setup (One-time)

```bash
# Install dependencies
./setup_parser_generator.sh

# Set API key
export ANTHROPIC_API_KEY="your-key-here"
```

### 2. Add New Institution

```bash
# Example: Adding TD Bank
mkdir statements/TD
cp ~/Downloads/TD-*.pdf statements/TD/

# Generate parser (takes 2-5 minutes)
venv/bin/python parser_generator/agent.py TD
```

### 3. Review & Test

```bash
# Review generated code
cat parsers/td_parser.py
cat parsers/td_analysis.md

# Test it
venv/bin/python -c "
from parsers.td_parser import TDParser
parser = TDParser('statements/TD/sample.pdf')
data = parser.parse()
print(f'Account: {data[\"account_number\"]}')
print(f'Holdings: {len(data[\"holdings\"])}')
"
```

### 4. Register & Use

```bash
# Add to configuration
venv/bin/python parser_loader.py add TD TDParser parsers.td_parser "TD investment accounts"

# Process all statements
venv/bin/python process_statements.py process
```

## Command Reference

```bash
# List configured parsers
venv/bin/python parser_loader.py list

# Test which parser will be used
venv/bin/python parser_loader.py test "path/to/statement.pdf"

# Generate parser for new institution
venv/bin/python parser_generator/agent.py <InstitutionName>

# Process statements
venv/bin/python process_statements.py process
venv/bin/python process_statements.py report
venv/bin/python process_statements.py all

# Reset database
venv/bin/python process_statements.py reset --reset-type data
venv/bin/python process_statements.py reset --reset-type all
```

## File Structure

```
statements/                      # PDF statements organized by institution
├── CIBC/
│   ├── CIBC-RRSP-*.pdf
│   └── CIBC-TFSA-*.pdf
├── ScotiaBank/
│   └── *.pdf
└── TD/                         # Your new institution
    └── *.pdf

parsers/                         # Parser implementations
├── base_parser.py              # Base class with utilities
├── cibc_investorsedge_parser.py
├── scotiabank_parser.py
└── td_parser.py                # Generated by agent

parser_generator/                # AI agent system
└── agent.py                    # CrewAI parser generator

institutions.yaml                # Parser configuration
parser_loader.py                 # Dynamic parser loading
process_statements.py            # Main application
```

## Configuration Example

`institutions.yaml`:
```yaml
institutions:
  TD:
    name: "TD Bank"
    parsers:
      - pattern: "*"
        class: "TDParser"
        module: "parsers.td_parser"
        description: "TD investment accounts"
```

## Tips

1. **Use 3-5 sample PDFs** from different months for better parser quality
2. **Check generated code** before using in production
3. **Test with all statement types** (RRSP, TFSA, Non-Registered)
4. **Edit if needed** - generated parsers are a starting point
5. **Version control** - commit successful parsers to git

## Troubleshooting

**Parser not detected:**
```bash
venv/bin/python parser_loader.py test "path/to/file.pdf"
# If not found, check institutions.yaml and directory name
```

**Import errors:**
```bash
# Make sure parser is added to institutions.yaml
venv/bin/python parser_loader.py add TD TDParser parsers.td_parser
```

**Extraction errors:**
```bash
# Review and edit the generated parser
vim parsers/td_parser.py
# Test specific methods
venv/bin/python -c "
from parsers.td_parser import TDParser
parser = TDParser('statements/TD/test.pdf')
# Test parsing
parser.parse()
"
```

## Full Documentation

See `PARSER_GENERATOR_README.md` for complete documentation.
